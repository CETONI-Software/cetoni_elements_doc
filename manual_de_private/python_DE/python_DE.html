<!DOCTYPE html>
<html class="writer-html5" lang="de" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>20. Python Add-on &mdash; CETONI Elements Privat Handbuch</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b20cc3f5" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/cetoni_style_override_css/style_override.css?v=ce09112c" />
      <link rel="stylesheet" type="text/css" href="../_static/cetoni_style_override_css/color_roles.css?v=7881a399" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=cad705d1"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../_static/translations.js?v=70a09b52"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script src="../_static/dark_mode_js/default_light.js?v=c2e647ce"></script>
        <script src="../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../genindex.html" />
    <link rel="search" title="Suche" href="../search.html" />
    <link rel="next" title="21. Datenbank Add-on" href="../database_DE/database_DE.html" />
    <link rel="prev" title="19. Grafischer Datenlogger" href="../graphlogger_DE/graphlogger_full_DE.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index_private.html" class="icon icon-home">
            CETONI Elements Privat Handbuch
              <img src="../_static/logo_cetoni_elements4.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Dokumentation durchsuchen" aria-label="Dokumentation durchsuchen" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Inhaltsverzeichnis:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Installation_DE/Installation_DE.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../QmixElementsADS_DE/QmixElementsADS_DE.html">2. Einführung CETONI Elements Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qmixdevices_DE/qmixdevices_full_DE.html">3. Erstellen von Gerätekonfigurationen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scriptingsystem_part1_DE/scriptingsystem_part1_DE.html">4. Script-System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scriptingsystem_part2_DE/scriptingsystem_part2_DE.html">5. Script Grundfunktionen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../javascript_DE/javascript_DE.html">6. Verwendung von JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nemesys_DE/nemesys_full_DE.html">7. Nemesys Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qmixio_DE/qmixio_full_DE.html">8. I/O Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qmixcontroller_DE/qmixcontroller_full_DE.html">9. Controller Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qmixv_DE/qmixv_full_DE.html">10. Ventil Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tubingpump_DE/tubingpump_DE.html">11. Schlauchpumpen Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rotaxys_DE/rotaxys_DE.html">12. Rotaxys / Nemaxys Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../balance_DE/balance_DE.html">13. Waagen Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ledarray_DE/ledarray_DE.html">14. LED Array Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cameraview_DE/cameraview_DE.html">15. Kamera Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../imageanalysis_DE/imageanalysis_DE.html">16. Bildbetrachter / Bildanalyse Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../videobuilder_DE/videobuilder_DE.html">17. Video Builder Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datalogger_DE/datalogger_full_DE.html">18. CSV-Datenlogger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../graphlogger_DE/graphlogger_full_DE.html">19. Grafischer Datenlogger</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">20. Python Add-on</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#einfuhrung-in-python-add-on">20.1. Einführung in Python Add-on</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">20.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python-console">20.3. Python Console</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ubersicht">20.3.1. Übersicht</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kontextmenu">20.3.2. Kontextmenü</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-vervollstandigung">20.3.3. Code-Vervollständigung</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fehlermeldungen">20.3.4. Fehlermeldungen</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#python-module">20.4. Python Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#standard-module-importieren">20.4.1. Standard Module importieren</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eigene-module-importieren">20.4.2. Eigene Module importieren</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#zugriff-auf-applikationsobjekte">20.5. Zugriff auf Applikationsobjekte</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#das-modul-cetoni-elements">20.5.1. Das Modul cetoni_elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eigenschaften-und-methoden-von-objekten-anzeigen">20.5.2. Eigenschaften und Methoden von Objekten anzeigen.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gerate-objekte-verwenden">20.5.3. Geräte-Objekte verwenden</a></li>
<li class="toctree-l3"><a class="reference internal" href="#applikationsobjekte-verwenden">20.5.4. Applikationsobjekte verwenden</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#python-scriptfunktionen-execute-python-code">20.6. Python Scriptfunktionen - Execute Python Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">20.6.1. Übersicht</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python-script-editor">20.6.2. Python Script Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#den-scriptabbruch-handeln-script-abort">20.6.3. Den Scriptabbruch handeln - script_abort()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementierung-der-funktionslogik-in-script-exec">20.6.4. Implementierung der Funktionslogik in script_exec()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fehler-bei-scriptausfuhrung">20.6.5. Fehler bei Scriptausführung</a></li>
<li class="toctree-l3"><a class="reference internal" href="#eigene-module-verwenden">20.6.6. Eigene Module verwenden</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zugriff-auf-scriptvariablen">20.6.7. Zugriff auf Scriptvariablen</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#beispielscripte">20.7. Beispielscripte</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#barcode-scanner">20.7.1. Barcode Scanner</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#api-referenz">20.8. API-Referenz</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scriptenv">20.8.1. ScriptEnv</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#_CPPv4NK6Python16CScriptEnvAccess14getDeviceNamesEv"><code class="docutils literal notranslate"><span class="pre">CScriptEnvAccess::getDeviceNames()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#_CPPv4NK6Python16CScriptEnvAccess9getDeviceERK7QString"><code class="docutils literal notranslate"><span class="pre">CScriptEnvAccess::getDevice()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#_CPPv4NK6Python16CScriptEnvAccess14getObjectNamesEv"><code class="docutils literal notranslate"><span class="pre">CScriptEnvAccess::getObjectNames()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#_CPPv4NK6Python16CScriptEnvAccess9getObjectERK7QString"><code class="docutils literal notranslate"><span class="pre">CScriptEnvAccess::getObject()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#_CPPv4NK6Python16CScriptEnvAccess6getVarERK7QString"><code class="docutils literal notranslate"><span class="pre">CScriptEnvAccess::getVar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#_CPPv4N6Python16CScriptEnvAccess6setVarERK7QStringRK8QVariant"><code class="docutils literal notranslate"><span class="pre">CScriptEnvAccess::setVar()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#_CPPv4N6Python16CScriptEnvAccess7setVarsEK11QVariantMap"><code class="docutils literal notranslate"><span class="pre">CScriptEnvAccess::setVars()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../database_DE/database_DE.html">21. Datenbank Add-on</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sila_DE/sila_DE.html">22. SiLA 2 Add-on</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spectroscopy_DE/spectroscopy_DE.html">23. Spektroskopie Add-on</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daq_DE/daq_DE.html">24. DAQ-Add-on</a></li>
<li class="toctree-l1"><a class="reference internal" href="../canopentools_DE/canopentools_DE.html">25. CANopen Tools Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix_DE/Appendix_DE.html">26. Anhang</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index_private.html">CETONI Elements Privat Handbuch</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index_private.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">20. </span>Python Add-on</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="python-add-on">
<h1><span class="section-number">20. </span>Python Add-on<a class="headerlink" href="#python-add-on" title="Link to this heading"></a></h1>
<img alt="../_images/python_header.svg" src="../_images/python_header.svg" /><section id="einfuhrung-in-python-add-on">
<h2><span class="section-number">20.1. </span>Einführung in Python Add-on<a class="headerlink" href="#einfuhrung-in-python-add-on" title="Link to this heading"></a></h2>
<div class="caution admonition">
<p class="admonition-title">Achtung</p>
<p>Das CETONI Elements Python Add-on ermöglicht Ihnen die Steuerung und
Automatisierung von Prozessen mit der Skriptsprache Python. Überprüfen Sie
die erstellten Skripte/Programme sowie die Parametereingaben, bevor Sie diese
zum ersten Mal ausführen! CETONI übernimmt keine Haftung für direkte und/oder
indirekte Schäden an Ihrem System oder externen Hard- und Softwarekomponenten,
die durch die von Ihnen erstellten Skripte/Programme oder durch die Verwendung
von Parametern, die für Ihre spezifische Anwendung nicht geeignet oder
ungünstig sind, entstehen.</p>
</div>
<p>Das Python-Add-on ermöglicht es Ihnen, Python-Code in CETONI Elements-Skripten
über eine entsprechende Skriptfunktion auszuführen. Es bietet somit eine einfache
Möglichkeit, die Skriptsprache Python in Ihre CETONI Elements Skripte einzubinden.</p>
<p>Der eingebettete Python-Interpreter bietet die gleiche Funktionalität wie die
Ausführung von Python-Skripten über den Befehl <strong class="command">python</strong>. D.h. wenn Sie
Bibliotheken über <strong class="command">pip</strong> für die vom Add-On verwendete Python-Version
installieren, stehen die Funktionen dieser Python-Bibliotheken auch in CETONI
Elements zur Verfügung.</p>
<p>Dadurch ergeben sich viele zusätzliche Möglichkeiten, wie z. B. der Zugriff auf
und das Parsen von Dateien, der Zugriff auf Datenbanken, die
TCP/IP-Netzwerkkommunikation über Python-Sockets oder die Nutzung komplexer,
in Python implementierter Analysefunktionen.</p>
</section>
<section id="installation">
<h2><span class="section-number">20.2. </span>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<p>Das Python Add-on ist nicht im Standard Installationspaket enthalten,
sondern muss als Add-on zusätzlich installiert werden. Die Versionen des
Python Add-ons und der installierten CETONI Elements Software sollten
übereinstimmen. Wenn Sie z.B. das Python Add-on mit der Versionsnummer
<strong>20220126</strong> installieren möchten, sollte die CETONI Elements Software mit
der Versionsnummer <strong>20220126</strong> installiert sein.</p>
<div class="note admonition">
<p class="admonition-title">Wichtig</p>
<p>Die Versionsnummer der CETONI Elements
Software und des Python Add-ons sollten übereinstimmen.
Die Versionsnummer des Python Add-ons darf niemals
größer sein als die der CETONI Elements Software. Je
weiter die Versionsnummern auseinander liegen, um so
größer ist das Risiko von Fehlfunktionen.</p>
</div>
<p>Starten Sie zur Installation die Datei <code class="file docutils literal notranslate"><span class="pre">CETONI_Elements_Python_64bit_Setup.exe</span></code>.
Der Installationsassistent führt Sie anschließend durch die Installation der Software.</p>
<img alt="../_images/10000201000001F300000184E6B4E02B1D179B7A.png" src="../_images/10000201000001F300000184E6B4E02B1D179B7A.png" />
<p>Zur Verwendung des Python Add-ons muss auf Ihrem Rechner eine
passende Python 64-bit Version installiert sein. Im Installationsschritt
<em>Choose Components</em> können Sie die benötigte Version sehen (hier z.B.
Python 3.8) und diese ggf. zur Installation auswählen, falls diese noch
nicht auf Ihrem Rechner vorhanden ist.</p>
<img alt="../_images/10000201000001F300000184EEFA5602FDC005BD.png" src="../_images/10000201000001F300000184EEFA5602FDC005BD.png" />
<div class="note admonition">
<p class="admonition-title">Wichtig</p>
<p>Unter Windows müssen Sie mit
Administratorrechten angemeldet sein, um das Add-on
installieren zu können, da es für alle Anwender
installiert wird.</p>
</div>
<div class="note admonition">
<p class="admonition-title">Wichtig</p>
<p>Die installierte Python Version <strong>muss</strong> der Version entsprechen, die im Installer
angegeben ist. Das Plugin wird mit anderen Versionen
nicht korrekt funktionieren.</p>
</div>
</section>
<section id="python-console">
<h2><span class="section-number">20.3. </span>Python Console<a class="headerlink" href="#python-console" title="Link to this heading"></a></h2>
<section id="ubersicht">
<h3><span class="section-number">20.3.1. </span>Übersicht<a class="headerlink" href="#ubersicht" title="Link to this heading"></a></h3>
<p>Das Python Add-on verfügt über eine Python Konsole, mit der Sie ähnlich
wie mit der Standard Python Konsole Python Code interaktiv eingeben und
ausführen können. Sie können die Python Konsole über das Hauptmenü
einblenden (<span class="menuselection">Window → Show View → Scripting → Python Console</span>):</p>
<img alt="../_images/10000201000001EB00000073BDF3384E8179E4AB.png" src="../_images/10000201000001EB00000073BDF3384E8179E4AB.png" />
<p>In der Python Konsole können Sie Kommandos ausprobieren,
den Zugriff auf Objekte testen und und sie hilft Ihnen bei der
Fehlersuche. Wenn Funktionsaufrufe in der Konsole funktionieren, dann
können Sie diese auch in Ihrem Script verwenden.</p>
</section>
<section id="kontextmenu">
<h3><span class="section-number">20.3.2. </span>Kontextmenü<a class="headerlink" href="#kontextmenu" title="Link to this heading"></a></h3>
<p>Das Kontextmenü der Python Konsole enthält die üblichen Befehle zur
Textbearbeitung</p>
<img alt="../_images/10000201000001F7000000E586F7E58BD20D8C3D.png" src="../_images/10000201000001F7000000E586F7E58BD20D8C3D.png" />
<p>Um den Inhalt der Konsole zu löschen, wählen im Kontextmenü
den Punkt <span class="guilabel">Clear</span> <span class="guinum">❶</span> oder klicken Sie in der Titelzeile auf das
Mülleimer Symbol <span class="guinum">❷</span>.</p>
<div class="caution admonition">
<p class="admonition-title">Achtung</p>
<p><strong>Gefahr von Fehlfunktion / Datenverlust !</strong></p>
<p>Verwenden Sie die Python Console nicht in einem
laufenden Versuch, Prozess oder während des normalen
Betriebs oder produktiven Einsatzes. Fehleingaben oder
der Zugriff auf Ressourcen kann unter Umständen zum
Absturz der Software führen.</p>
</div>
</section>
<section id="code-vervollstandigung">
<h3><span class="section-number">20.3.3. </span>Code-Vervollständigung<a class="headerlink" href="#code-vervollstandigung" title="Link to this heading"></a></h3>
<p>Die Python Konsole unterstützt Sie bei der Eingabe durch eine einfache
Code-Vervollständigung. D.h., wenn Sie Module importiert haben, dann
unterstützt Sie die Code-Vervollständigung bei der Eingabe durch
passende Vorschläge, wie Sie es auch aus anderen Code-Editoren gewohnt
sind.</p>
<img alt="../_images/10000201000001F80000008CC938D11BE28032EE.png" src="../_images/10000201000001F80000008CC938D11BE28032EE.png" />
<p>Im Beispiel oben wurden alle Funktionen aus dem Modul
<em>cetoni_elements</em> importiert. Nach der Eingabe von <code class="code docutils literal notranslate"><span class="pre">ScriptEnv.get</span></code>
werden passende Funktionen für das Objekt <code class="code docutils literal notranslate"><span class="pre">ScriptEnv</span></code> angezeigt, die mit
<code class="code docutils literal notranslate"><span class="pre">get</span></code> beginnen.</p>
</section>
<section id="fehlermeldungen">
<h3><span class="section-number">20.3.4. </span>Fehlermeldungen<a class="headerlink" href="#fehlermeldungen" title="Link to this heading"></a></h3>
<p>Fehler, die bei der Ausführung von Code in der Python Konsole auftreten,
aber auch Fehler die bei der Ausführung von Python Code in der Python
Scriptfunktion auftreten, werden Ihnen in der Python Konsole als roter
Text angezeigt.</p>
<img alt="../_images/10000201000001EF00000062B50A9A0A013ADF8C.png" src="../_images/10000201000001EF00000062B50A9A0A013ADF8C.png" />
</section>
</section>
<section id="python-module">
<h2><span class="section-number">20.4. </span>Python Module<a class="headerlink" href="#python-module" title="Link to this heading"></a></h2>
<section id="standard-module-importieren">
<h3><span class="section-number">20.4.1. </span>Standard Module importieren<a class="headerlink" href="#standard-module-importieren" title="Link to this heading"></a></h3>
<p>Das Plugin verwendet eine Standard Python Installation und hat somit
Zugriff auf alle Standardmodule von Python oder auf andere Module, die
via <code class="file docutils literal notranslate"><span class="pre">pip</span></code> installiert wurden. Sie können ein Modul wie gewohnt mittels
<code class="code docutils literal notranslate"><span class="pre">import</span></code> Anweisung importieren. Im folgenden Beispiel wird das <code class="file docutils literal notranslate"><span class="pre">time</span></code>
Modul importiert und verwendet:</p>
<img alt="../_images/10000201000001F80000008C5125B8F7F53F8BDD.png" src="../_images/10000201000001F80000008C5125B8F7F53F8BDD.png" />
</section>
<section id="eigene-module-importieren">
<h3><span class="section-number">20.4.2. </span>Eigene Module importieren<a class="headerlink" href="#eigene-module-importieren" title="Link to this heading"></a></h3>
<p>Wenn Sie eigene Module verwenden, die Sie zusammen mit Ihrem Projekt
weitergeben oder ausliefern wollen, dann können Sie diese in den
Unterordner <code class="file docutils literal notranslate"><span class="pre">Scripts/Python</span></code> ihres aktuellen Projekts speichern. Dieses
Verzeichnis wird von der Software zum <code class="code docutils literal notranslate"><span class="pre">sys.path</span></code> des Python Interpreters
hinzugefügt. Wenn Sie z.B. im Projekt <em>PythonDev</em> arbeiten, dann wäre
der absolute Pfad zu diesem Verzeichnis:</p>
<p class="centered">
<strong><code class="file docutils literal notranslate"><span class="pre">C:/Users/Public/Documents/QmixElements/Projects/PythonDev/Scripts/Python</span></code></strong></p><p>Wenn Sie in der Python Konsole das Modul <code class="code docutils literal notranslate"><span class="pre">sys</span></code> importieren, dann können
Sie via <code class="code docutils literal notranslate"><span class="pre">sys.path</span></code> sehen, dass sich das o.g. Verzeichnis im Importpfad
befindet.</p>
<img alt="../_images/100002010000025D00000083173EACC09611440F.png" src="../_images/100002010000025D00000083173EACC09611440F.png" />
<p>Zum Test der Importfunktionalität erstellen Sie in dem o.g.
Ordner die Datei <code class="file docutils literal notranslate"><span class="pre">hello.py</span></code> mit folgendem Inhalt:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">helloworld</span><span class="p">():</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Sie können dieses Modul nun importieren und die Funktion <code class="code docutils literal notranslate"><span class="pre">helloworld</span></code>
verwenden:</p>
<img alt="../_images/100002010000021E0000007B7A4EF3D62F1DF696.png" src="../_images/100002010000021E0000007B7A4EF3D62F1DF696.png" />
</section>
</section>
<section id="zugriff-auf-applikationsobjekte">
<h2><span class="section-number">20.5. </span>Zugriff auf Applikationsobjekte<a class="headerlink" href="#zugriff-auf-applikationsobjekte" title="Link to this heading"></a></h2>
<section id="das-modul-cetoni-elements">
<h3><span class="section-number">20.5.1. </span>Das Modul cetoni_elements<a class="headerlink" href="#das-modul-cetoni-elements" title="Link to this heading"></a></h3>
<p>Die Software fügt dem Python-Interpreter ein Modul <code class="code docutils literal notranslate"><span class="pre">cetoni_elements</span></code>
hinzu, das für den Zugriff auf Applikationsobjekte verwendet werden
kann. Nach dem import des Moduls über <code class="code docutils literal notranslate"><span class="pre">from</span> <span class="pre">cetoni_elements</span> <span class="pre">import</span> <span class="pre">*</span></code>
können Sie auf diese Objekte zugreifen. Das <a class="reference internal" href="#scriptenv"><span class="std std-ref">ScriptEnv</span></a>-Objekt ist das zentrale
Objekt für den Zugriff auf verfügbare Geräte und Anwendungsobjekte.</p>
<div class="admonition note">
<p class="admonition-title">Bemerkung</p>
<p>Siehe <a class="reference internal" href="#api-referenz"><span class="std std-ref">Python-API</span></a> für eine detaillierte Beschreibung des ScriptEnv-Objekts.</p>
</div>
<p>Das folgende Bild zeigt, wie man das Modul <code class="code docutils literal notranslate"><span class="pre">cetoni_elements</span></code> importiert und
dann die Funktion <code class="code docutils literal notranslate"><span class="pre">help()</span></code> des Objekts <a class="reference internal" href="#scriptenv">ScriptEnv</a> aufruft:</p>
<img alt="../_images/10000201000001F100000088C0C4A7C7C9B93CC8.png" src="../_images/10000201000001F100000088C0C4A7C7C9B93CC8.png" />
</section>
<section id="eigenschaften-und-methoden-von-objekten-anzeigen">
<h3><span class="section-number">20.5.2. </span>Eigenschaften und Methoden von Objekten anzeigen.<a class="headerlink" href="#eigenschaften-und-methoden-von-objekten-anzeigen" title="Link to this heading"></a></h3>
<p>Mit der Python Funktion <code class="code docutils literal notranslate"><span class="pre">dir(object)</span></code> können Sie sich alle Methoden und
Eigenschaften von Applikationsobjekten anzeigen lassen. Damit können Sie
sich z.B. alle Funktionen und Eigenschaften des <code class="code docutils literal notranslate"><span class="pre">ScriptEnv</span></code> Objekts
anzeigen lassen.</p>
<img alt="../_images/10000201000002260000007A3CE2023C617A29C5.png" src="../_images/10000201000002260000007A3CE2023C617A29C5.png" />
<p>Alternativ verfügen alle Applikationsobjekte auch über eine
<code class="code docutils literal notranslate"><span class="pre">help()</span></code> Funktion, die eine übersichtlichere Anzeige der Eigenschaften
und Methoden eines Objekts ermöglicht. In der Abbildung unten ist der
Aufruf von <code class="code docutils literal notranslate"><span class="pre">ScriptEnv.help()</span></code> zu sehen. In der Konsole werden Ihnen die
Eigenschaften (<code class="code docutils literal notranslate"><span class="pre">Properties</span></code> <span class="guinum">❶</span>) und Methoden (<code class="code docutils literal notranslate"><span class="pre">Slots</span></code> <span class="guinum">❷</span>) des
<code class="code docutils literal notranslate"><span class="pre">ScriptEnv</span></code> Objekts angezeigt:</p>
<a class="reference internal image-reference" href="../_images/10000201000002260000011A8780E1969FECAAC9.png"><img alt="../_images/10000201000002260000011A8780E1969FECAAC9.png" src="../_images/10000201000002260000011A8780E1969FECAAC9.png" style="width: 14.557cm;" /></a>
<div class="admonition tip">
<p class="admonition-title">Tipp</p>
<p>Verwenden Sie die <code class="code docutils literal notranslate"><span class="pre">dir(object)</span></code> und die
<code class="code docutils literal notranslate"><span class="pre">Object.help()</span></code> Funktionen, um sich einen Überblick
über die Methoden und Eigenschaften eines bestimmten
Objekts zu verschaffen.</p>
</div>
</section>
<section id="gerate-objekte-verwenden">
<h3><span class="section-number">20.5.3. </span>Geräte-Objekte verwenden<a class="headerlink" href="#gerate-objekte-verwenden" title="Link to this heading"></a></h3>
<p>Über die Funktion <code class="code docutils literal notranslate"><span class="pre">ScriptEnv.getDevice()</span></code> können Sie auf Geräteobjekte
zugreifen. Um eine Übersicht der verfügbaren Gerätenamen zu erhalten,
können Sie die Funktion <code class="code docutils literal notranslate"><span class="pre">ScriptEnv.getDeviceNames()</span></code> aufrufen.</p>
<img alt="../_images/1000020100000240000000AEB0E9BCC2CF19CA4A.png" src="../_images/1000020100000240000000AEB0E9BCC2CF19CA4A.png" />
<p>Die Code-Vervollständigung unterstützt Sie bei der Eingabe
eines Gerätenamens, indem sie Ihnen eine Liste passender Namen anzeigt
(siehe Abbildung oben). Wenn Sie die Funktion <code class="code docutils literal notranslate"><span class="pre">getDevice()</span></code> aufrufen,
ohne eine Zuweisung an eine Variable, dann können Sie in der Konsole
sehen, ob der Aufruf erfolgreich war:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>py&gt;<span class="w"> </span>ScriptEnv.getDevice<span class="o">(</span><span class="s2">&quot;Nemesys_S_1&quot;</span><span class="o">)</span>
CNemesys4Pump<span class="w"> </span><span class="o">(</span>QtLabb::CNemesys4Pump<span class="w"> </span>at:<span class="w"> </span>0x000002402DDCBF20<span class="o">)</span>
</pre></div>
</div>
<p>Um auf ein Gerät zugreifen zu können, weisen Sie das Ergebnis des
Aufrufs von <code class="code docutils literal notranslate"><span class="pre">getDevice()</span></code> einer Variable zu. Im folgenden Beispiel
weisen wir der Variable <code class="code docutils literal notranslate"><span class="pre">pump</span></code> das Geräteobjekt für die erste Nemesys S
Pumpe zu:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>py&gt;<span class="w"> </span><span class="nv">pump</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ScriptEnv.getDevice<span class="o">(</span><span class="s2">&quot;Nemesys_S_1&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>Nun können Sie sich mit Hilfe der <code class="code docutils literal notranslate"><span class="pre">dir(pump)</span></code> und der <code class="code docutils literal notranslate"><span class="pre">pump.help()</span></code>
Funktionen einen Überblick über die verfügbaren Methoden und Funktionen
des Pumpen Objekts verschaffen.</p>
<div class="admonition tip">
<p class="admonition-title">Tipp</p>
<p>Verwenden Sie die <code class="code docutils literal notranslate"><span class="pre">dir(object)</span></code> und die
<code class="code docutils literal notranslate"><span class="pre">Object.help()</span></code> Funktionen, um sich einen Überblick
über die Methoden und Eigenschaften von Geräteobjekten
zu verschaffen.</p>
</div>
<div class="note admonition">
<p class="admonition-title">Wichtig</p>
<p>Der Zugriff auf Geräteeigenschaften und
-methoden oder die Anzeige der Hilfe via
<code class="code docutils literal notranslate"><span class="pre">Object.help()</span></code> ist bei vielen Geräten nur möglich,
wenn die Anwendung zu den Geräten verbunden ist.</p>
</div>
<div class="caution admonition">
<p class="admonition-title">Achtung</p>
<p><strong>Gefahr von Fehlfunktion / Datenverlust !</strong></p>
<p>Über Gerätefunktionen haben Sie ggf. Zugriff auf
Funktionen die in der grafischen Oberfläche nicht zur
Verfügung stehen. Testen Sie Funktionen stets außerhalb
laufender Prozesse und nicht während eines produktiven
Einsatzes. Fehleingaben oder der Zugriff auf
Ressourcen, Methoden oder Eigenschaften kann unter
Umständen zu Fehlfunktionen oder zum Absturz der
Software führen.</p>
</div>
<p>Wenn Sie mit dem Geräte verbunden sind, können Sie nun über die
Gerätefunktionen auf das Gerät zugreifen. So können Sie z.B. bei der
Pumpe einen Refill Vorgang auslösen:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>py&gt;<span class="w"> </span>pump.refillSyringe<span class="o">()</span>
</pre></div>
</div>
<p>oder den Pumpvorgang stoppen:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>py&gt;<span class="w"> </span>pump.stopPumping<span class="o">()</span>
</pre></div>
</div>
<p>Der folgende Code zeigt, wie Sie das <code class="code docutils literal notranslate"><span class="pre">cetoni_elements</span></code> Modul
importieren, sich über das <code class="code docutils literal notranslate"><span class="pre">ScriptEnv</span></code> Objekt das Geräteobjekt für die
Nemesys S Pumpe besorgen und dann einen Entleervorgang der Spritze
starten:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>py&gt;<span class="w"> </span>from<span class="w"> </span>cetoni_elements<span class="w"> </span>import
py&gt;<span class="w"> </span><span class="nv">pump</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ScriptEnv.getDevice<span class="o">(</span><span class="s2">&quot;Nemesys_S_1&quot;</span><span class="o">)</span>
py&gt;<span class="w"> </span>pump.emptySyringe<span class="o">()</span>
</pre></div>
</div>
</section>
<section id="applikationsobjekte-verwenden">
<h3><span class="section-number">20.5.4. </span>Applikationsobjekte verwenden<a class="headerlink" href="#applikationsobjekte-verwenden" title="Link to this heading"></a></h3>
<p>Ähnlich wie bei Geräteobjekten, können Sie auch auf Applikationsobjekte,
die keine Geräte sind zugreifen. Verwenden Sie dafür die beiden
Funktionen <code class="code docutils literal notranslate"><span class="pre">ScriptEnv.getObject()</span></code> und <code class="code docutils literal notranslate"><span class="pre">criptEnv.getObjectNames()</span></code>.</p>
<p>Der folgende Code zeigt, wie Sie das <code class="code docutils literal notranslate"><span class="pre">cetoni_elements</span></code> Modul
importieren, sich über das <code class="code docutils literal notranslate"><span class="pre">ScriptEnv</span></code> Objekt das Applikationsobjekt des
grafischen Loggers besorgen und anschließend das Logging starten:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>py&gt;<span class="w"> </span>from<span class="w"> </span>cetoni_elements<span class="w"> </span>import<span class="w"> </span>*
py&gt;<span class="w"> </span><span class="nv">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ScriptEnv.getObject<span class="o">(</span><span class="s2">&quot;ProcessDataGraph&quot;</span><span class="o">)</span>
py&gt;<span class="w"> </span>plot.startLogging<span class="o">()</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tipp</p>
<p>Verwenden Sie die <code class="code docutils literal notranslate"><span class="pre">dir(object)</span></code> und die
<code class="code docutils literal notranslate"><span class="pre">Object.help()</span></code> Funktionen, um sich einen Überblick
über die Methoden und Eigenschaften von
Applikationsobjekten zu verschaffen.</p>
</div>
<div class="caution admonition">
<p class="admonition-title">Achtung</p>
<p><strong>Gefahr von Fehlfunktion / Datenverlust !</strong></p>
<p>Über die Funktionen der Applikationsobjekte haben Sie
ggf. Zugriff auf Funktionen die in der grafischen
Oberfläche nicht zur Verfügung stehen. Testen Sie
Funktionen stets außerhalb laufender Prozesse und nicht
während eines produktiven Einsatzes. Fehleingaben oder
der Zugriff auf Ressourcen, Methoden oder Eigenschaften
kann unter Umständen zu Fehlfunktionen oder zum Absturz
der Software führen.</p>
</div>
</section>
</section>
<section id="python-scriptfunktionen-execute-python-code">
<h2><span class="section-number">20.6. </span>Python Scriptfunktionen - Execute Python Code<a class="headerlink" href="#python-scriptfunktionen-execute-python-code" title="Link to this heading"></a></h2>
<section id="id1">
<h3><span class="section-number">20.6.1. </span>Übersicht<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<a class="reference internal image-reference" href="../_images/1000139A00000B6A00000B5A63C99382F8AF9D57.svg"><img alt="../_images/1000139A00000B6A00000B5A63C99382F8AF9D57.svg" class="align-left" src="../_images/1000139A00000B6A00000B5A63C99382F8AF9D57.svg" width="60px" /></a>
<p>Das Python Plugin fügt dem Script-Pool die Scriptfuktion
<code class="code docutils literal notranslate"><span class="pre">Execute</span> <span class="pre">Python</span> <span class="pre">Code</span></code> hinzu, die in der Kategorie <span class="guilabel">Core Functions</span>
des <span class="guilabel">Script Pool</span> zur Verfügung steht:</p>
<img alt="../_images/1000020100000109000001120A8A8A9BB7B494E7.png" src="../_images/1000020100000109000001120A8A8A9BB7B494E7.png" />
<p>Diese Funktion ermöglicht die Ausführung von Python Code im
Scriptsystem der Anwendung. Wenn Sie die Funktion in Ihr Script
einfügen, sehen Sie im Konfigurationsbereich das initiale Python Script.
Dieses Script enthält die beiden Funktionen <code class="code docutils literal notranslate"><span class="pre">script_exec()</span></code> und
<code class="code docutils literal notranslate"><span class="pre">script_abort()</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Implement your script logic in this function</span>
<span class="c1"># Avoid blocking function calls</span>
<span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
   <span class="k">return</span>


<span class="c1"># Implement your clean up code here in case of script stop</span>
<span class="c1"># Stop pending actions, clean up resources</span>
<span class="c1"># Keep execution time of this function short and do not use</span>
<span class="c1"># any blocking function calls</span>
<span class="k">def</span> <span class="nf">script_abort</span><span class="p">():</span>
   <span class="k">return</span>
</pre></div>
</div>
<p>Bei der Ausführung des Scripts wird dieses vom Python
Interpreter als eigenes Modul geladen und dann die Funktion
<code class="code docutils literal notranslate"><span class="pre">script_exec()</span></code> ausgeführt. D.h. diese Funktion ist die Hauptfunktion
des Scripts und die Logik sollte dort implementiert werden.</p>
<div class="admonition tip">
<p class="admonition-title">Tipp</p>
<p>Alle Möglichkeiten auf Geräteobjekte und
Applikationsobjekte zuzugreifen, die in der Python
Konsole der Anwendung zur Verfügung stehen, können auch
in der Scriptfunktion verwendet werden.</p>
</div>
<p>Der Python Interpreter kann stets nur ein Python Script gleichzeitig
ausführen. Eine parallele Ausführung ist nicht möglich. Wenn Sie Python
Scripte in parallelen Sequenzen verwenden, dann werden die Scripte
hintereinander ausgeführt, d.h. ein paralleler Ausführungszweig
blockiert solange, bis die Ausführung eines Scriptes in einem anderen
Zweig abgeschlossen ist. Dies ist ein weiterer Grund dafür, dass Sie die
Ausführungszeit der Scripte so kurz wie möglich halten sollten.
Verwenden Sie nicht blockierende Python Scripte mit kurzen
Ausführungszeiten, so ist auch eine „quasi parallele“ Ausführung in
parallelen Sequenzen möglich.</p>
<div class="note admonition">
<p class="admonition-title">Wichtig</p>
<p>Eine parallele Ausführung mehrerer Python
Funktionen ist nicht möglich. Werden Python Scripte in
parallelen Sequenzen verwendet, so werden diese
nacheinander ausgeführt.</p>
</div>
</section>
<section id="python-script-editor">
<h3><span class="section-number">20.6.2. </span>Python Script Editor<a class="headerlink" href="#python-script-editor" title="Link to this heading"></a></h3>
<p>Die Python Script Funktion verfügt über einen Python Code Editor, der
Sie beim Schreiben von Python Code unterstützt.</p>
<img alt="../_images/10000201000002220000012B6A5FF31AA3060F79.png" src="../_images/10000201000002220000012B6A5FF31AA3060F79.png" />
<p>Der Editor verfügt über</p>
<ul class="simple">
<li><p>Syntax Highlighting für Python Code <span class="guinum">❶</span></p></li>
<li><p>eine einfache Code Vervollständigung</p></li>
<li><p>Code Folding <span class="guinum">❷</span></p></li>
<li><p>Zeilennummern <span class="guinum">❸</span></p></li>
<li><p>Undo / Redo Funktionalität <span class="guinum">❹</span></p></li>
</ul>
<p>Einige Funktionen des Editors stehen über das Kontextmenü zur Verfügung,
andere Funktionen sind über Tastenkürzel verfügbar. Hier einige der
Funktionen:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Aktion</p></th>
<th class="head"><p>Tastaturkürzel</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Schriftgröße vergrößern</p></td>
<td><p><kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">+</kbd></p></td>
</tr>
<tr class="row-odd"><td><p>Schriftgröße verkleinern</p></td>
<td><p><kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">-</kbd></p></td>
</tr>
<tr class="row-even"><td><p>Schriftgröße auf Standard zurücksetzen</p></td>
<td><p><kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">0</kbd></p></td>
</tr>
<tr class="row-odd"><td><p>Ausgewählten Codeblock einrücken</p></td>
<td><p><kbd class="kbd docutils literal notranslate">Tab</kbd></p></td>
</tr>
<tr class="row-even"><td><p>Ausgewählten Codeblock ausrücken</p></td>
<td><p><kbd class="kbd docutils literal notranslate">Shift</kbd> + <kbd class="kbd docutils literal notranslate">Tab</kbd></p></td>
</tr>
<tr class="row-odd"><td><p>Undo</p></td>
<td><p><kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">Z</kbd> oder Kontextmenü</p></td>
</tr>
<tr class="row-even"><td><p>Redo</p></td>
<td><p><kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">Y</kbd> oder Kontextmenü</p></td>
</tr>
</tbody>
</table>
<div class="note admonition">
<p class="admonition-title">Wichtig</p>
<p>Das Editieren des Python Quelltextes ist
nur möglich, wenn das Script nicht läuft. Sobald das
Script gestartet wurde ist das Editieren des
Quelltextes gesperrt. Im Falle eines Fehlers müssen Sie
das Script über die <em>Terminate Script</em> Schaltfläche
beenden, bevor Sie den Python Code editieren können.</p>
</div>
</section>
<section id="den-scriptabbruch-handeln-script-abort">
<h3><span class="section-number">20.6.3. </span>Den Scriptabbruch handeln - script_abort()<a class="headerlink" href="#den-scriptabbruch-handeln-script-abort" title="Link to this heading"></a></h3>
<p>Wenn das laufende Script über die <span class="guilabel">Terminate Script</span> Schaltfläche des
Script Editors (siehe Abbildung unten) abgebrochen wird, dann wird die
Ausführung von <code class="code docutils literal notranslate"><span class="pre">script_exec()</span></code> unterbrochen und die Funktion
<code class="code docutils literal notranslate"><span class="pre">script_abort()</span></code> wird ausgeführt:</p>
<img alt="../_images/10000201000001950000009E1928E5F4B3BBCE66.png" src="../_images/10000201000001950000009E1928E5F4B3BBCE66.png" />
<p>Im Fall eines solchen Abbruchs sehen Sie in der Python
Konsole eine entsprechende Fehlermeldung:</p>
<img alt="../_images/10000201000001F60000006B04A15868149985AC.png" src="../_images/10000201000001F60000006B04A15868149985AC.png" />
<p>Wenn Sie auf den Abbruch des Scripts reagieren möchten, z.B.
um Ressourcen freizugeben oder um den Anwender zu informieren, dann
können Sie dies in der <code class="code docutils literal notranslate"><span class="pre">script_abort()</span></code> Funktion tun. Wenn Sie in der
<code class="code docutils literal notranslate"><span class="pre">script_abort()</span></code> Funktion auf Daten oder Objekte (z.B. File Handels,
Sockets o.ä) zugreifen möchten, die Sie in der <code class="code docutils literal notranslate"><span class="pre">script_exec()</span></code> Funktion
verwendet haben, so können Sie dies über globale Variablen tun. Das
folgende Script zeigt ein entsprechendes Beispiel. In der
<code class="code docutils literal notranslate"><span class="pre">script_abort()</span></code> Funktion wird die Anzahl der Schleifendurchläufe
ausgegeben, die bis zum Abbruch des Scripts durchlaufen wurden. Beide
Funktionen greifen dafür auf die globale Variable <code class="code docutils literal notranslate"><span class="pre">counter</span></code> zu:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="n">counter</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
   <span class="k">global</span> <span class="n">counter</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
      <span class="n">counter</span> <span class="o">=</span> <span class="n">i</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
      <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="k">return</span>

<span class="k">def</span> <span class="nf">script_abort</span><span class="p">():</span>
   <span class="k">global</span> <span class="n">counter</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;script_abort() after &quot;</span><span class="p">,</span> <span class="n">counter</span><span class="p">,</span> <span class="s2">&quot; loops&quot;</span><span class="p">)</span>
   <span class="k">return</span>
</pre></div>
</div>
</section>
<section id="implementierung-der-funktionslogik-in-script-exec">
<h3><span class="section-number">20.6.4. </span>Implementierung der Funktionslogik in script_exec()<a class="headerlink" href="#implementierung-der-funktionslogik-in-script-exec" title="Link to this heading"></a></h3>
<p>Bei der Implementierung des Scriptes in <code class="code docutils literal notranslate"><span class="pre">script_exec()</span></code> sollten Sie
darauf achten, keine blockierenden Funktionen oder blockierendes Warten
zu verwenden. Der Python Interpreter kann über die <span class="guilabel">Terminate Script</span>
Schaltfläche nur <strong>nach</strong> der Ausführung des aktuellen Python
Statements unterbrochen werden. Sollte das aktuelle Statement ein
blockierender Funktionsaufruf sein, z.B. <code class="code docutils literal notranslate"><span class="pre">time.wait(10)</span></code>, kann der
Interpreter erst nach 10 Sekunden unterbrochen werden wenn der <em>wait</em>
Aufruf beendet wurde. Versehen Sie deshalb blockierende Funktionsaufrufe
immer mit einem Timeout.</p>
<div class="note admonition">
<p class="admonition-title">Wichtig</p>
<p>Verwenden Sie keine blockierenden
Funktionsaufrufe um einen Abbruch der Skriptausführung
nicht zu blockieren. Versehen Sie blockierende
Funktionsaufrufe stets mit einem Timeout.</p>
</div>
<p>Im folgenden Beispiel ist der Aufruf von <code class="code docutils literal notranslate"><span class="pre">socket.recv()</span></code> in Zeile 8
blockierend. D.h. der Aufruf kehrt erst zurück, wenn Daten empfangen
wurden. Solange keine Daten empfangen werden, blockiert die Funktion und
das Script kann nicht sauber abgebrochen werden:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span>

<span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
   <span class="n">HOST</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>  <span class="c1"># The server&#39;s hostname or IP address</span>
   <span class="n">PORT</span> <span class="o">=</span> <span class="mi">65432</span>        <span class="c1"># The port used by the server</span>
   <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
      <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
   <span class="k">return</span>
</pre></div>
</div>
<p>Um dieses Problem zu beheben sollte der Aufruf von <code class="code docutils literal notranslate"><span class="pre">socket.recv()</span></code> mit
einem Timeout versehen werden. Dies wurde im folgenden Beispiel mit
Hilfe der Funktion <code class="code docutils literal notranslate"><span class="pre">socket.settimeout()</span></code> umgesetzt:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span>

<span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
   <span class="n">HOST</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>  <span class="c1"># The server&#39;s hostname or IP address</span>
   <span class="n">PORT</span> <span class="o">=</span> <span class="mi">65432</span>        <span class="c1"># The port used by the server</span>
   <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
      <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
      <span class="n">s</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
      <span class="k">try</span><span class="p">:</span>
         <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
   <span class="k">return</span>
</pre></div>
</div>
</section>
<section id="fehler-bei-scriptausfuhrung">
<h3><span class="section-number">20.6.5. </span>Fehler bei Scriptausführung<a class="headerlink" href="#fehler-bei-scriptausfuhrung" title="Link to this heading"></a></h3>
<p>Wenn während der Ausführung eines Scripts Fehler auftreten, werden Ihnen
diese im <span class="guilabel">Event Log</span> und in der Python-Konsole <span class="guilabel">Python console</span>
angezeigt. Wenn Sie im
Event Log die Maus über die Fehlermeldung bewegen, sehen Sie ein
Hinweisfenster mit den Details:</p>
<img alt="../_images/1000020100000299000000B54BF487EBAF7E8E66.png" src="../_images/1000020100000299000000B54BF487EBAF7E8E66.png" />
<p>In der Python Konsole wird Ihnen die Fehlermeldung als roter
Fehlertext angezeigt:</p>
<img alt="../_images/10000201000001D000000061F880AB480C04AA56.png" src="../_images/10000201000001D000000061F880AB480C04AA56.png" />
<p>In der Fehlermeldung erhalten Sie auch die Information, in
welcher Zeile des Scripts ein Fehler aufgetreten ist. Das hilft Ihnen,
im Script-Editor den Fehler zu finden und zu beheben.</p>
<div class="note admonition">
<p class="admonition-title">Wichtig</p>
<p>Das Editieren des Python Quelltextes ist
nur möglich, wenn das Script nicht läuft. Sobald das
Script gestartet wurde ist das Editieren des
Quelltextes gesperrt. Im Falle eines Fehlers müssen Sie
das Script über die <span class="guilabel">Terminate Script</span> Schaltfläche
beenden, bevor Sie den Python Code editieren können.</p>
</div>
</section>
<section id="eigene-module-verwenden">
<h3><span class="section-number">20.6.6. </span>Eigene Module verwenden<a class="headerlink" href="#eigene-module-verwenden" title="Link to this heading"></a></h3>
<p>Wenn Ihr Script eine sehr komplexe und umfangreiche Logik enthält,
können Sie den Code ggf. in ein externes Modul auslagern und über die
Importfunktionalität einbinden (siehe Abschnitt <a class="reference internal" href="#eigene-module-verwenden">Eigene Module
verwenden</a>). Sie können
dann aus <code class="code docutils literal notranslate"><span class="pre">script_exec()</span></code> heraus die Funktionen des importierten Moduls
aufrufen.</p>
<p>Im folgenden Beispiel importieren wir unser eigenes Modul <code class="file docutils literal notranslate"><span class="pre">hello</span></code> und
rufen daraus die Funktion <code class="code docutils literal notranslate"><span class="pre">helloworld()</span></code> auf.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hello</span>

<span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
   <span class="n">hello</span><span class="o">.</span><span class="n">helloworld</span><span class="p">()</span>
   <span class="k">return</span>
</pre></div>
</div>
<p>Dies Ausgabe des Scripts erscheint sowohl im Event Log:</p>
<img alt="../_images/100002010000018E0000004E45BDDA2F2CB1A1E9.png" src="../_images/100002010000018E0000004E45BDDA2F2CB1A1E9.png" />
<p>als auch in der Python Konsole:</p>
<img alt="../_images/1000020100000157000000475414DB3324BBC74A.png" src="../_images/1000020100000157000000475414DB3324BBC74A.png" />
<p>Wenn Sie das Modul bereits importiert haben und danach noch
Änderungen am externen Modul durchführen, dann sind diese Änderungen in
Ihrem Python Script in der Anwendung nicht verfügbar. Dies ist das
normale Verhalten des Python Interpreters – wenn ein Modul einmal
importiert wurde, dann wird es nicht erneut importiert. Fügen Sie
testweise Ihrem eigenen <code class="file docutils literal notranslate"><span class="pre">hello</span></code> Modul die Funktion <code class="code docutils literal notranslate"><span class="pre">hellouniverse()</span></code>
hinzu:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hellouniverse</span><span class="p">():</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello universe&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Bei der Ausführung erhalten Sie die Information, dass die Funktion
<code class="code docutils literal notranslate"><span class="pre">hellouniverse</span></code> nicht verfügbar ist.</p>
<p>Um zu verhindern, dass Sie nach der Änderung des externen Moduls die
Anwendung neu starten müssen, um das Modul erneut zu importieren, können
Sie in Ihrem Script mit der <code class="code docutils literal notranslate"><span class="pre">reload()</span></code> Funktion aus dem Modul
<code class="file docutils literal notranslate"><span class="pre">importlib</span></code> explizit ein Reload anfordern. Ändern Sie dafür Ihr Python
Script in der Anwendung wie folgt ab:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hello</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">reload</span>

<span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
   <span class="n">reload</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span> <span class="c1"># trigger explicit reload of hello module</span>
   <span class="n">hello</span><span class="o">.</span><span class="n">helloworld</span><span class="p">()</span>
   <span class="n">hello</span><span class="o">.</span><span class="n">hellouniverse</span><span class="p">()</span>
   <span class="k">return</span>
</pre></div>
</div>
<p>Das Script wird nun korrekt ausgeführt.</p>
<div class="admonition tip">
<p class="admonition-title">Tipp</p>
<p>Verwenden Sie die <code class="code docutils literal notranslate"><span class="pre">importlib.reload()</span></code>
Funktion, wenn Sie Änderungen an externen Modulen
durchführen, nachdem Sie diese bereits via import in
Ihr Python Script in der Anwendung importiert haben.</p>
</div>
</section>
<section id="zugriff-auf-scriptvariablen">
<h3><span class="section-number">20.6.7. </span>Zugriff auf Scriptvariablen<a class="headerlink" href="#zugriff-auf-scriptvariablen" title="Link to this heading"></a></h3>
<p>Um die Ergebnisse von Berechnungen im Python Code an das laufende Script
übergeben zu können oder auf Werte aus dem Script reagieren zu können,
ist der Zugriff auf Scriptvariablen möglich. Dazu importieren Sie das
Modul <code class="file docutils literal notranslate"><span class="pre">cetoni_elements</span></code> (siehe Abschnitt <a class="reference internal" href="#das-modul-cetoni-elements">Das Modul cetoni_elements</a>).</p>
<p>Wenn Sie das Modul importiert haben, können Sie über die Funktionen
<code class="code docutils literal notranslate"><span class="pre">ScriptEnv.getVar()</span></code>, <code class="code docutils literal notranslate"><span class="pre">ScriptEnv.setVar()</span></code> und
<code class="code docutils literal notranslate"><span class="pre">ScriptEnv.setVars()</span></code> auf Scriptvariablen zugreifen. Das folgende
Beispiel zeigt, wie die Scriptvariable <code class="code docutils literal notranslate"><span class="pre">$Flow</span></code> gelesen, um 2
inkrementiert und dann der berechnete Wert wieder in der Scriptvariablen
gespeichert wird:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cetoni_elements</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
   <span class="n">flow</span> <span class="o">=</span> <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="s2">&quot;$Flow&quot;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
   <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
   <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">setVar</span><span class="p">(</span><span class="s2">&quot;$Flow&quot;</span><span class="p">,</span> <span class="n">flow</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
   <span class="k">return</span>
</pre></div>
</div>
<div class="note admonition">
<p class="admonition-title">Wichtig</p>
<p>Beachten Sie, das Scripvariablen auch im
Python Script immer mit einem Dollarzeichen beginnen -
<code class="code docutils literal notranslate"><span class="pre">$VarName</span></code>.</p>
</div>
<p>Mit Hilfe von Scriptvariablen kann auch auf Geräte zugegriffen werden.
Scriptvariablen können Gerätereferenzen speichern. Durch das Lesen der
Gerätereferenz und der Zuweisung an eine Python Variable kann auf das
Geräteobjekt zugegriffen werden. Im folgenden Beispiel enthält die
Scriptvariable <code class="code docutils literal notranslate"><span class="pre">$Pump1</span></code> eine Gerätereferenz der Pumpe <em>Nemesys_S_1</em>, die
der Variablen in der <em>Create Variable</em> Funktion zugewiesen wurde. Die
Gerätereferenz wird aus der Variable gelesen und der Python Variable
<code class="code docutils literal notranslate"><span class="pre">pump</span></code> zugewiesen. Nun kann über die <code class="code docutils literal notranslate"><span class="pre">pump</span></code> Variable auf
Gerätefunktionen zugegriffen werden. In diesem Beispiel wird die Spritze
via <code class="code docutils literal notranslate"><span class="pre">pump.emptySyringe()</span></code> entleert:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cetoni_elements</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
   <span class="n">pump</span> <span class="o">=</span> <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="s2">&quot;$Pump1&quot;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">pump</span><span class="p">)</span>
   <span class="n">pump</span><span class="o">.</span><span class="n">emptySyringe</span><span class="p">()</span>
   <span class="k">return</span>
</pre></div>
</div>
<p>Im Python Code ist es auch möglich Listen zu erzeugen, und diese in
einer Variablen zu speichern. Das folgende Beispiel erzeugt eine Liste
aus 4 Werten und speichert diese in der Scriptvariable <code class="code docutils literal notranslate"><span class="pre">$Positions</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cetoni_elements</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
   <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">setVar</span><span class="p">(</span><span class="s2">&quot;$Positions&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
   <span class="k">return</span>
</pre></div>
</div>
<p>Statt einfacher Werte können auch Listen von Geräten erzeugt und in
Variablen gespeichert werden. Im folgenden Beispiel wird eine Liste
erzeugt, welche die beiden Digitalen Eingänge der ersten <em>Nemesys S</em>-Pumpe
enthält. Diese Liste wird in der Scriptvariable <code class="code docutils literal notranslate"><span class="pre">$DigitalInputs</span></code>
gespeichert.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cetoni_elements</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
   <span class="n">di1</span> <span class="o">=</span> <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">getDevice</span><span class="p">(</span><span class="s2">&quot;Nemesys_S_1_DigIN1&quot;</span><span class="p">)</span>
   <span class="n">di2</span> <span class="o">=</span> <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">getDevice</span><span class="p">(</span><span class="s2">&quot;Nemesys_S_1_DigIN2&quot;</span><span class="p">)</span>
   <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">setVar</span><span class="p">(</span><span class="s2">&quot;$DigitalInputs&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">di1</span><span class="p">,</span> <span class="n">di2</span><span class="p">])</span>
   <span class="k">return</span>
</pre></div>
</div>
</section>
</section>
<section id="beispielscripte">
<h2><span class="section-number">20.7. </span>Beispielscripte<a class="headerlink" href="#beispielscripte" title="Link to this heading"></a></h2>
<section id="barcode-scanner">
<h3><span class="section-number">20.7.1. </span>Barcode Scanner<a class="headerlink" href="#barcode-scanner" title="Link to this heading"></a></h3>
<p>Das folgende Beispielscript zeigt, wie die Kamera Unterstützung von
CETONI Elements verwendet werden kann, um mit Hilfe des
<a class="reference external" href="https://pypi.org/project/pyzbar/">pyzbar</a> Moduls einen Barcode
Scanner zu implementieren:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">pyzbar</span> <span class="kn">import</span> <span class="n">pyzbar</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">qimage2ndarray</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">cetoni_elements</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="c1"># Main script function</span>
<span class="linenos"> 7</span><span class="k">def</span> <span class="nf">script_exec</span><span class="p">():</span>
<span class="linenos"> 8</span>   <span class="n">barcode</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 9</span>   <span class="n">camera</span> <span class="o">=</span> <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="s1">&#39;Qmix_CAM_1&#39;</span><span class="p">)</span>
<span class="linenos">10</span>   <span class="n">qimage</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">capturedPreviewImage</span><span class="p">()</span>
<span class="linenos">11</span>   <span class="n">frame</span> <span class="o">=</span> <span class="n">qimage2ndarray</span><span class="o">.</span><span class="n">rgb_view</span><span class="p">(</span><span class="n">qimage</span><span class="p">)</span>
<span class="linenos">12</span>   <span class="n">barcodes</span> <span class="o">=</span> <span class="n">pyzbar</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="linenos">13</span>   <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">barcodes</span><span class="p">:</span>
<span class="linenos">14</span>      <span class="n">barcode</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="linenos">15</span>      <span class="k">break</span>
<span class="linenos">16</span>
<span class="linenos">17</span>   <span class="c1"># output</span>
<span class="linenos">18</span>   <span class="k">if</span> <span class="n">barcode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">19</span>      <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">setVar</span><span class="p">(</span><span class="s1">&#39;$Barcode&#39;</span><span class="p">,</span> <span class="n">barcode</span><span class="p">)</span>
<span class="linenos">20</span>   <span class="k">else</span><span class="p">:</span>
<span class="linenos">21</span>      <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">setVar</span><span class="p">(</span><span class="s1">&#39;$Barcode&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">22</span>   <span class="k">return</span>
</pre></div>
</div>
<p>Durch den Import des Moduls <code class="file docutils literal notranslate"><span class="pre">cetoni_elements</span></code> kann auf die Kamera
zugegriffen und ein Bild aufgenommen werden:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">camera</span> <span class="o">=</span> <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="s1">&#39;Qmix_CAM_1&#39;</span><span class="p">)</span>
<span class="n">qimage</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">capturedPreviewImage</span><span class="p">()</span>
</pre></div>
</div>
<p>Das Modul <a class="reference external" href="https://pypi.org/project/qimage2ndarray/">qimage2ndarrays</a>
hilft uns dabei, das aufgenommene Bild im Format <code class="code docutils literal notranslate"><span class="pre">QImage</span></code> in ein
<code class="code docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> zu konvertieren, welches vom
<a class="reference external" href="https://pypi.org/project/pyzbar/">pyzbar</a> Modul verwendet wird.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">qimage2ndarray</span><span class="o">.</span><span class="n">rgb_view</span><span class="p">(</span><span class="n">qimage</span><span class="p">)</span>
</pre></div>
</div>
<p>Nun können wir das <a class="reference external" href="https://pypi.org/project/pyzbar/">pyzbar</a> Modul
verwenden um den Barcode zu decodieren:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">barcodes</span> <span class="o">=</span> <span class="n">pyzbar</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">barcodes</span><span class="p">:</span>
   <span class="n">barcode</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
   <span class="k">break</span>
</pre></div>
</div>
<p>Im letzten Schritt wird der Barcode mit der Funktion
<code class="code docutils literal notranslate"><span class="pre">ScriptEnv.setVar()</span></code> in der Scriptvariable <code class="code docutils literal notranslate"><span class="pre">$Barcode</span></code> gespeichert, damit
er im Script zur Verfügung steht und ausgewertet werden kann.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">barcode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
   <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">setVar</span><span class="p">(</span><span class="s1">&#39;$Barcode&#39;</span><span class="p">,</span> <span class="n">barcode</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
   <span class="n">ScriptEnv</span><span class="o">.</span><span class="n">setVar</span><span class="p">(</span><span class="s1">&#39;$Barcode&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">return</span>
</pre></div>
</div>
</section>
</section>
<section id="api-referenz">
<h2><span class="section-number">20.8. </span>API-Referenz<a class="headerlink" href="#api-referenz" title="Link to this heading"></a></h2>
<section id="scriptenv">
<h3><span class="section-number">20.8.1. </span>ScriptEnv<a class="headerlink" href="#scriptenv" title="Link to this heading"></a></h3>
<p>Das <code class="code docutils literal notranslate"><span class="pre">ScriptEnv</span></code>-Objekt ist das zentrale Objekt für den Zugriff auf
verfügbare Geräte und Anwendungsobjekte.</p>
<div class="breathe-sectiondef docutils container">
<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4NK6Python16CScriptEnvAccess14getDeviceNamesEv">
<span id="_CPPv3NK6Python16CScriptEnvAccess14getDeviceNamesEv"></span><span id="_CPPv2NK6Python16CScriptEnvAccess14getDeviceNamesEv"></span><span id="Python::CScriptEnvAccess::getDeviceNamesC"></span><span class="target" id="classPython_1_1CScriptEnvAccess_1aeccbcc8aa4e70a6fecd2da066ec0c8fe"></span><span class="n"><span class="pre">QStringList</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">getDeviceNames</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><span class="w"> </span><span class="k"><span class="pre">const</span></span><a class="headerlink" href="#_CPPv4NK6Python16CScriptEnvAccess14getDeviceNamesEv" title="Link to this definition"></a><br /></dt>
<dd><p>Returns a tuple with all device names that can be accessed from Python. </p>
<p>Use the device name when calling the <code class="docutils literal notranslate"><a class="reference internal" href="#classPython_1_1CScriptEnvAccess_1a91f6851b867ed8e7f2ff06479b1c726a"><span class="std std-ref"><span class="pre">getDevice()</span></span></a></code> function to get the corresponding device object. </p>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4NK6Python16CScriptEnvAccess9getDeviceERK7QString">
<span id="_CPPv3NK6Python16CScriptEnvAccess9getDeviceERK7QString"></span><span id="_CPPv2NK6Python16CScriptEnvAccess9getDeviceERK7QString"></span><span id="Python::CScriptEnvAccess::getDevice__QStringCRC"></span><span class="target" id="classPython_1_1CScriptEnvAccess_1a91f6851b867ed8e7f2ff06479b1c726a"></span><span class="n"><span class="pre">QtLabb</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">Core</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">CDevice</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">getDevice</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">QString</span></span><span class="w"> </span><span class="p"><span class="pre">&amp;</span></span><span class="n sig-param"><span class="pre">Name</span></span><span class="sig-paren">)</span><span class="w"> </span><span class="k"><span class="pre">const</span></span><a class="headerlink" href="#_CPPv4NK6Python16CScriptEnvAccess9getDeviceERK7QString" title="Link to this definition"></a><br /></dt>
<dd><p>Returns the device object for the given device name. </p>
<p>The device object provides access to device-specific functions and properties of this device. The device names are the names that are also used in the CETONI Elements script system to access devices or device properties.</p>
<p><strong>Example:</strong> <div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">pump</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ScriptEnv</span><span class="p">.</span><span class="n">getDevice</span><span class="p">(</span><span class="s">&quot;Nemesys_S_1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</p>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4NK6Python16CScriptEnvAccess14getObjectNamesEv">
<span id="_CPPv3NK6Python16CScriptEnvAccess14getObjectNamesEv"></span><span id="_CPPv2NK6Python16CScriptEnvAccess14getObjectNamesEv"></span><span id="Python::CScriptEnvAccess::getObjectNamesC"></span><span class="target" id="classPython_1_1CScriptEnvAccess_1aebc2b852d0b10062fdf0ad18fbca3859"></span><span class="n"><span class="pre">QStringList</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">getObjectNames</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><span class="w"> </span><span class="k"><span class="pre">const</span></span><a class="headerlink" href="#_CPPv4NK6Python16CScriptEnvAccess14getObjectNamesEv" title="Link to this definition"></a><br /></dt>
<dd><p>Returns a list of all registered application objects that are not devices and that can be accessed from Python, such as the graphical logger. </p>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4NK6Python16CScriptEnvAccess9getObjectERK7QString">
<span id="_CPPv3NK6Python16CScriptEnvAccess9getObjectERK7QString"></span><span id="_CPPv2NK6Python16CScriptEnvAccess9getObjectERK7QString"></span><span id="Python::CScriptEnvAccess::getObject__QStringCRC"></span><span class="target" id="classPython_1_1CScriptEnvAccess_1a503f83d2297c44a6617c539bc798e0fb"></span><span class="n"><span class="pre">QObject</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">getObject</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">QString</span></span><span class="w"> </span><span class="p"><span class="pre">&amp;</span></span><span class="n sig-param"><span class="pre">Name</span></span><span class="sig-paren">)</span><span class="w"> </span><span class="k"><span class="pre">const</span></span><a class="headerlink" href="#_CPPv4NK6Python16CScriptEnvAccess9getObjectERK7QString" title="Link to this definition"></a><br /></dt>
<dd><p>Returns the object with the given object name <code class="docutils literal notranslate"><span class="pre">Name</span></code>. </p>
<p><strong>Example:</strong> <div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ScriptEnv</span><span class="p">.</span><span class="n">getObject</span><span class="p">(</span><span class="s">&quot;ProcessDataGraph&quot;</span><span class="p">)</span>
</pre></div>
</div>
</p>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4NK6Python16CScriptEnvAccess6getVarERK7QString">
<span id="_CPPv3NK6Python16CScriptEnvAccess6getVarERK7QString"></span><span id="_CPPv2NK6Python16CScriptEnvAccess6getVarERK7QString"></span><span id="Python::CScriptEnvAccess::getVar__QStringCRC"></span><span class="target" id="classPython_1_1CScriptEnvAccess_1ac97676172ce79c81a8aa15b994909ae9"></span><span class="n"><span class="pre">QVariant</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">getVar</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">QString</span></span><span class="w"> </span><span class="p"><span class="pre">&amp;</span></span><span class="n sig-param"><span class="pre">VarName</span></span><span class="sig-paren">)</span><span class="w"> </span><span class="k"><span class="pre">const</span></span><a class="headerlink" href="#_CPPv4NK6Python16CScriptEnvAccess6getVarERK7QString" title="Link to this definition"></a><br /></dt>
<dd><p>Returns the value of a certain script variable. </p>
<p>The variable name needs to start with a dollar sign.</p>
<p><strong>Example:</strong> <div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">flow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ScriptEnv</span><span class="p">.</span><span class="n">getVar</span><span class="p">(</span><span class="s">&quot;$FlowRate&quot;</span><span class="p">)</span>
</pre></div>
</div>
</p>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N6Python16CScriptEnvAccess6setVarERK7QStringRK8QVariant">
<span id="_CPPv3N6Python16CScriptEnvAccess6setVarERK7QStringRK8QVariant"></span><span id="_CPPv2N6Python16CScriptEnvAccess6setVarERK7QStringRK8QVariant"></span><span id="Python::CScriptEnvAccess::setVar__QStringCR.QVariantCR"></span><span class="target" id="classPython_1_1CScriptEnvAccess_1a7710c14e9b48f9b779c2819b59d30a49"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">setVar</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">QString</span></span><span class="w"> </span><span class="p"><span class="pre">&amp;</span></span><span class="n sig-param"><span class="pre">Name</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">QVariant</span></span><span class="w"> </span><span class="p"><span class="pre">&amp;</span></span><span class="n sig-param"><span class="pre">Value</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N6Python16CScriptEnvAccess6setVarERK7QStringRK8QVariant" title="Link to this definition"></a><br /></dt>
<dd><p>Sets the value of the script variable to the given value. </p>
<p><strong>Example:</strong> <div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ScriptEnv</span><span class="p">.</span><span class="n">setVar</span><span class="p">(</span><span class="s">&quot;$TargetPos&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</p>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N6Python16CScriptEnvAccess7setVarsEK11QVariantMap">
<span id="_CPPv3N6Python16CScriptEnvAccess7setVarsEK11QVariantMap"></span><span id="_CPPv2N6Python16CScriptEnvAccess7setVarsEK11QVariantMap"></span><span id="Python::CScriptEnvAccess::setVars__QVariantMapC"></span><span class="target" id="classPython_1_1CScriptEnvAccess_1a94259e9a9d31737b8940a7c7d9dd4b87"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">setVars</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">QVariantMap</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">Values</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N6Python16CScriptEnvAccess7setVarsEK11QVariantMap" title="Link to this definition"></a><br /></dt>
<dd><p>Sets multiple script variables using a Python dictionary. </p>
<p><strong>Example:</strong> <div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ScriptEnv</span><span class="p">.</span><span class="n">setVars</span><span class="p">({</span><span class="s">&quot;$Value1&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;$Value2&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1.5</span><span class="p">})</span>
</pre></div>
</div>
</p>
</dd></dl>

</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../graphlogger_DE/graphlogger_full_DE.html" class="btn btn-neutral float-left" title="19. Grafischer Datenlogger" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Zurück</a>
        <a href="../database_DE/database_DE.html" class="btn btn-neutral float-right" title="21. Datenbank Add-on" accesskey="n" rel="next">Weiter <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, CETONI GmbH.
      <span class="lastupdated">Zuletzt aktualisiert am Jan. 28, 2026 14:14.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>